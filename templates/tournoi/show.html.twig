{% extends 'base.html.twig' %}

{% block title %}DÃ©tails du Tournoi - {{ tournoi.nom }}{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1 class="text-center">ğŸ† {{ tournoi.nom }}</h1>
    
    <div class="row mt-3">
        <div class="col-md-6">
            <p><strong>ğŸ“… Date de dÃ©but :</strong> {{ tournoi.dateDebut|date('d/m/Y H:i') }}</p>
            <p><strong>ğŸ Date de fin :</strong> {{ tournoi.dateFin|date('d/m/Y H:i') }}</p>
            <p><strong>ğŸ“Š Statut :</strong> 
                <span class="badge {% if tournoi.status == 'Ã€ venir' %}bg-success{% elseif tournoi.status == 'En cours' %}bg-warning{% else %}bg-danger{% endif %}">
                    {{ tournoi.status }}
                </span>
            </p>
            <p><strong>ğŸ‘¥ Nombre max d'Ã©quipes :</strong> {{ tournoi.nbMaxEquipes }}</p>
        </div>
    </div>

    {# ğŸ”¹ Gestion de l'inscription #}
    {% if app.user %}
        <div class="mt-3">
            {% if tournoi.participants.contains(app.user) %}
                <form action="{{ path('tournoi_desinscription', { id: tournoi.id }) }}" method="POST">
                    <button type="submit" class="btn btn-danger">âŒ Se dÃ©sinscrire</button>
                </form>
            {% elseif tournoi.status == 'Ã€ venir' %}
                <form action="{{ path('tournoi_inscription', { id: tournoi.id }) }}" method="POST">
                    <button type="submit" class="btn btn-success">âœ… S'inscrire</button>
                </form>
            {% endif %}
        </div>
    {% else %}
        <p class="text-muted">ğŸ”¹ Connectez-vous pour vous inscrire au tournoi.</p>
    {% endif %}

    {# ğŸ”¹ Bouton pour gÃ©nÃ©rer les matchs (admin uniquement) #}
    {% if is_granted('ROLE_ADMIN') and tournoi.status == 'Ã€ venir' %}
        <a href="{{ path('tournoi_generate_matches', { id: tournoi.id }) }}" class="btn btn-primary mt-3">âš¡ GÃ©nÃ©rer les matchs</a>
    {% endif %}

    {# ğŸ”¹ Liste des participants #}
    <h2 class="mt-4">ğŸ‘¥ Participants</h2>
    {% if tournoi.participants|length > 0 %}
        <ul class="list-group">
            {% for participant in tournoi.participants %}
                <li class="list-group-item">{{ participant.email }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-muted">Aucun participant pour le moment.</p>
    {% endif %}

    {# ğŸ”¹ Affichage des matchs #}
    <h2 class="mt-4">ğŸ† Matchs</h2>
    {% if tournoi.games|length > 0 %}
    <h2 class="mt-4">ğŸ† Matchs</h2>
    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Ã‰quipe A</th>
                <th>Score</th>
                <th>Ã‰quipe B</th>
                <th>Score</th>
                <th>Vainqueur</th>
            </tr>
        </thead>
        <tbody>
            {% for game in tournoi.games %}
                <tr>
                    <td>{{ game.equipeA.nom }}</td>
                    <td>{{ game.scoreEquipeA is not null ? game.scoreEquipeA : '-' }}</td>
                    <td>{{ game.equipeB.nom }}</td>
                    <td>{{ game.scoreEquipeB is not null ? game.scoreEquipeB : '-' }}</td>
                    <td>
                        {% if game.vainqueur is not null %}
                            ğŸ‰ {{ game.vainqueur.nom }}
                        {% else %}
                            âš ï¸ Pas encore jouÃ©
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-muted">âš ï¸ Aucun match gÃ©nÃ©rÃ© pour le moment.</p>
{% endif %}

   
    {# ğŸ”¹ Bouton pour voir le bracket du tournoi #}
    <a href="{{ path('tournoi_bracket', { id: tournoi.id }) }}" class="btn btn-primary mt-3">ğŸ“Š Voir le bracket</a>


    {# ğŸ”¹ Bouton de retour aux tournois #}
    <a href="{{ path('tournois_list') }}" class="btn btn-secondary mt-3">â¬…ï¸ Retour Ã  la liste des tournois</a>
</div>
{% endblock %}
